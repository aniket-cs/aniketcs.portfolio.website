import{c as P,d as F}from"https://app.framerstatic.com/chunk-K2TY2TEO.mjs";import{a as I,b as k}from"https://app.framerstatic.com/chunk-TBB27SWX.mjs";import{a as b,d as M}from"https://app.framerstatic.com/chunk-CNUIA4VA.mjs";import{c as S}from"https://app.framerstatic.com/chunk-ONYSHV6S.mjs";import{e as x,k as w,l as C,t as T}from"https://app.framerstatic.com/chunk-IFLV2SXW.mjs";import{e as y}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var o=y(I());var H=y(k()),A=T("services:hooks:useiframewithchannel"),L=class extends Error{constructor(m,f={}){super(m);this.extras=f}};function W(r){let{onSetup:d=()=>{},targetOrigin:m,type:f,src:h}=r,i=h;if(h){let{pathname:e,search:t,hash:u}=new URL(h),c=`${e}${t}${u}`;F(c),i=P(c).url}let[p,v]=(0,o.useReducer)((e,t)=>(e&&b.shared().unregister(e).catch(u=>{u instanceof S.ServiceGone||w(u)}),t),null),l=(0,o.useRef)(null),a=(0,o.useRef)(null),n=(0,o.useRef)({onError:null,onLoad:null});return(0,o.useEffect)(()=>{if(!i||!l.current){a.current=null,p&&v(null);return}if(a.current)return;let e=document.createElement("iframe");e.src=i,e.style.border="none",e.style.display="block",e.style.height="100%",e.style.width="100%",e.dataset.testid=`${f}-iframe`,e.allowFullscreen=!0;let t=s=>{v(null),A.reportError(new L("iframe load error",{message:s.message,filename:s.filename,lineno:s.lineno,colno:s.colno,error:s.error}))};e.addEventListener("error",t),n.current.onError=t;let u=new URL(i,document.baseURI).origin,c=e.sandbox;c?.add("allow-downloads"),c?.add("allow-popups"),c?.add("allow-popups-to-escape-sandbox"),c?.add("allow-same-origin"),c?.add("allow-scripts"),c?.add("allow-forms"),e.allow=O(f),l.current.appendChild(e),a.current=e;let D=()=>{let{contentWindow:s}=e;return s?new M(s,m??u):(l.current?.removeChild(e),null)},R=()=>{let s=D();v(s)};return e.addEventListener("load",R),n.current.onLoad=R,d(e)},[p,v,d,i,m,f]),(0,o.useEffect)(()=>()=>{n.current.onError&&a.current?.removeEventListener("error",n.current.onError),n.current.onLoad&&a.current?.removeEventListener("load",n.current.onLoad),n.current.onError=null,n.current.onLoad=null,a.current=null,v(null)},[]),[(0,o.useCallback)(function(t){return(0,o.useEffect)(()=>{if(l.current?.children.length===0&&a.current)throw new Error("IFrameWithChannel was re-rendered. The Service connection will be broken.")}),(0,H.jsx)("div",{...t,ref:l})},[]),p,a.current]}function O(r){let d=["accelerometer","ambient-light-sensor","autoplay","camera","display-capture","encrypted-media","fullscreen","geolocation","gyroscope","magnetometer","microphone","midi","picture-in-picture","speaker","usb","vibrate","vr","xr-spatial-tracking"];return r!=="canvas"&&d.push("clipboard-read","clipboard-write"),d.join("; ")}var E=y(I());function z(r,d){let m={service:r.service.service,onDiscover:r.onDiscover},f=(0,E.useRef)(m);if(f.current.service!==m.service)throw new Error("useServiceStream: service must be identical between re-renders");let h={onStreamValue:d,onError:r.onError},i=(0,E.useRef)(h);i.current=h;let p=(0,E.useRef)(),v=()=>{let a=p.current;p.current=void 0,a?.cancel().catch(()=>{})},{channel:l}=r;(0,E.useEffect)(()=>l?((async()=>{let n=!1,g=0;for(;!n;){n=!0;try{let e=f.current,t=await b.shared().discover(e.service,l),u=e.onDiscover(t);p.current=u,g=0,await u.read(c=>i.current.onStreamValue(c))}catch(e){let t=i.current.onError(C(e));if(g++,g>1)continue;t?.retry===!0&&(await x(0),n=!1)}}})().catch(w),v):void 0,[l])}function B(r){if(r instanceof S.ServiceGone)return{retry:!0};w(r)}export{W as a,O as b,z as c,B as d};
//# sourceMappingURL=https://app.framerstatic.com/chunk-A7I3U7CO.mjs.map
