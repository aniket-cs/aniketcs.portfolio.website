import{$ as M,$a as _,Yc as j,j as E,kb as N,ve as H}from"https://app.framerstatic.com/chunk-52WXMGQT.mjs";import{e as U,i as w}from"https://app.framerstatic.com/chunk-UOO5WELQ.mjs";import{f as K}from"https://app.framerstatic.com/chunk-EZF75KBF.mjs";import{od as W,rc as V,rd as P}from"https://app.framerstatic.com/chunk-CU2BZLXE.mjs";import{Bd as b,Cd as S,Nh as F,Sp as B,Td as O,Ud as k,qd as R,yd as x}from"https://app.framerstatic.com/chunk-O5AMU6IS.mjs";import{c as I,d as A}from"https://app.framerstatic.com/chunk-RLZ2GVNE.mjs";import{o as L}from"https://app.framerstatic.com/chunk-WKO4Y66Q.mjs";import{g as l}from"https://app.framerstatic.com/chunk-X5STD3PC.mjs";import{Y as T,q as D,t as g}from"https://app.framerstatic.com/chunk-J7RAPXVX.mjs";import{a as u}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{a as C}from"https://app.framerstatic.com/chunk-DFNFZLDR.mjs";import{j as s,k as y,l as v,o as h}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";function ye(r,o){if(!r||r.changes.length===0)return!1;for(let e of r.changes){let t=o.get(e.id);if(!k(t)&&!O(t)&&!(!t&&e.added==="RedirectRouteNode"))return!1}return!0}function z(r,o){if(!r||r.changes.length===0)return!1;for(let e of r.changes){let t=o.get(e.id);return!t||!B(t)?!1:"variables"in e.from}return!0}function G(r,o){if(!r||r.changes.length===0)return!1;for(let e of r.changes){let t=o.get(e.id);if(!R(t))return!1;let n="locales";return!!(n in e.from||e.from._deleted?.includes(n))}return!0}var oe={type:"None",source:"undefined"},Q=class extends W{constructor(){super(...arguments);s(this,"stack",[]);s(this,"dismiss",()=>{this.stack=T.pop(this.stack)});s(this,"isVisible",()=>this.active.type!=="None");s(this,"shouldShowConfirmationModal",e=>localStorage.getItem(te(e))!=="true");s(this,"shouldBlockUndoRedo",(e,t)=>{switch(this.active.type){case"None":return!1;case"Variables":return!z(e,t);case"LocaleSettings":return!G(e,t);default:return!0}})}get active(){return this.stack[this.stack.length-1]??oe}trackModalOpen({type:e,source:t}){K("modal_open",{modalType:e,source:t})}push(e){this.stack=T.push(this.stack,e),this.trackModalOpen(e)}set(e){this.stack=[e],this.trackModalOpen(e)}dismissModal(e){this.stack=T.filter(this.stack,t=>t.type!==e)}displayComponentIsolationModal({source:e}){let t="componentIsolationModal",n="1";l.isAutomation||l.isE2E||l.isTest||localStorage.getItem(t)!==n&&(localStorage.setItem(t,n),setTimeout(()=>{this.processWhenReady(()=>{this.set({type:"ComponentIsolationModal",source:e})})},0))}};function te(r){return`confirmation-modal-do-not-show-again-${r}`}var re=g("EngineChanges");var Y=class{constructor(){s(this,"changes",new Set);s(this,"addChanges",(...o)=>{for(let e of o)this.changes.add(e)});s(this,"changeObserverFlags",[]);s(this,"changeObservers",[]);s(this,"inSignalAllObservers",!1);s(this,"observersToRemove",[])}get flags(){return this.changes}has(...o){for(let e of o)if(this.changes.has(e))return!0;return!1}observe(...o){let e=o.pop(),t=o;return l.isDebugBuild&&t.some(n=>n===void 0)&&re.warn("changes.observe was called with undefined as one of the flags. It might be caused by observing a store that hasn't been instantiated yet."),this.changeObserverFlags.push(t),this.changeObservers.push(e),e}observeWithComponent(o,e,t){this.changeObserverFlags.push(o);let n=()=>{l.benchmarkSkipRendering||e.setState(t())};return this.changeObservers.push(n),n}removeObserver(o){if(this.inSignalAllObservers){this.observersToRemove.push(o);return}let e=this.changeObservers.indexOf(o);e!==-1&&(this.changeObserverFlags.splice(e,1),this.changeObservers.splice(e,1))}signalAllObservers(){if(!this.changes)return;let o=this.changes,e=this.changeObserverFlags,t=this.changeObservers;this.inSignalAllObservers=!0;for(let n=0;n<e.length;n++){let a=e[n];for(let i of a)if(o.has(i)){t[n]();break}}if(this.inSignalAllObservers=!1,this.observersToRemove.length>0){for(let n of this.observersToRemove)this.removeObserver(n);this.observersToRemove.length=0}this.changes.clear()}signalObserversFor(...o){let e=new Set(o),t=this.changeObserverFlags,n=this.changeObservers;for(let a=0;a<t.length;a++){let i=t[a];for(let d of i)if(e.has(d)){n[a]();break}}e.forEach(a=>this.changes.delete(a))}};function Oe(r,o){let e,t,n,a;for(let d of r)b(d,!0)?(o===d.id&&(e=e??d),d.dataIdentifier?n=n??d:t=t??d):S(d,!0)&&(a=a??d);let i=e??t??n??a;return u(i,"getFirstCanvasPageOrWebPageNode: Tree must contain at least one Canvas Page or Web Page"),i}function ke(r){return r?b(r,!0)||S(r,!0)||x(r,!0):!1}var c,f,$=class{constructor(o){this.limit=o;v(this,c,0);v(this,f,[])}async run(o,e){if(y(this,c)===this.limit){let t=new Promise(n=>{y(this,f).push(n)});e&&(t=Promise.race([t,ne(e)])),await t}J(e),h(this,c)._++;try{return await o()}finally{h(this,c)._--,y(this,f).shift()?.()}}};c=new WeakMap,f=new WeakMap;var q=new WeakMap;function ne(r){let o=q.get(r);return o||(J(r),o=new Promise((e,t)=>{r.addEventListener("abort",()=>{t(r.reason)},{once:!0})}),q.set(r,o)),o}function J(r){if(r?.aborted)throw r.reason}function ie(r){return r!==void 0?{ok:!0,value:r}:{ok:!0}}function ae(r){return{ok:!1,error:r}}function we(r){return r.then(o=>ie(o),o=>ae(o))}var Ke=D({canvas:()=>{let r=se();return A(r),I(r)},onPageCanvas:()=>{let r=de();return A(r),I(r)}});function se(){let r=l.isDebugBuild?"canvas-sandbox.debug.html":"canvas-sandbox.html",o=P(`./${r}`),e=JSON.stringify(C());return o+`#services=${encodeURIComponent(e)}`}function de(){let r=l.isDebugBuild?"canvas-sandbox-on-page.debug.html":"canvas-sandbox-on-page.html",o=P(`./${r}`),e=JSON.stringify(C());return o+`#services=${encodeURIComponent(e)}`}var le=3,m=g("PartialTreeSender"),X=class{constructor(o,e){this.timeline=o;s(this,"name");s(this,"currentScopeId","");s(this,"timelineCursor");s(this,"scopeBufferMap",new Map);this.name=e+"-"+String(Math.round(Math.random()*1e3))}resetScopeBuffer(o){this.scopeBufferMap.clear(),this.currentScopeId=o??"",o&&(this.timelineCursor=void 0,this.scopeBufferMap.set(o,performance.now()))}updateScopeBuffer(o){if(this.currentScopeId===o)return[void 0,void 0];if(this.currentScopeId=o,this.scopeBufferMap.has(this.currentScopeId))return this.scopeBufferMap.set(this.currentScopeId,performance.now()),[void 0,void 0];let e;if(this.scopeBufferMap.size>=le){let t=1/0,n="";for(let[a,i]of this.scopeBufferMap)t>i&&(t=i,n=a);u(n.length>0,"must have removed a scope from the buffer"),this.scopeBufferMap.delete(n),e=n}return this.scopeBufferMap.set(this.currentScopeId,performance.now()),[e,o]}reset(o){let e=this.timeline.tree;return this.resetScopeBuffer(o),ee(e,o)}update(o){if(!o)return{};let e=this.timeline.tree,t=this.timeline.fetchForwardChanges(this.timelineCursor);if(!t)return this.timeline.invalidatedByLoadCompletedDocument(this.timelineCursor)?(m.debug(this.name,"cursor invalidated, sending empty update for load completed document"),this.timelineCursor=this.timeline.getChangeTrackingCursor(),{}):(m.debug(this.name,"cursor invalidated, sending tree with scope:",o),this.resetScopeBuffer(o),this.timelineCursor=this.timeline.getChangeTrackingCursor(),{name:this.name,tree:ee(e,o),timestamp:Date.now()});let[n,a]=this.updateScopeBuffer(o);n&&(m.debug(this.name,"deleting scope by diff:",n),Z(n,t)),t.length===0&&(t=void 0);let i;if(a&&(m.debug(this.name,"adding scope by subtree:",a),i=this.getScopeSubTree(e,a)),t){let d=this.getAffectedScopeIDsAfterCrossScopeMove(e,t);for(let p of d){if(p!==this.currentScopeId){this.scopeBufferMap.has(p)&&(m.debug(this.name,"deleting scope due to cross-scope move:",p),Z(p,t),this.scopeBufferMap.delete(p));continue}i||(m.debug(this.name,"resending tree with scope due to cross-scope move:",p),i=this.getScopeSubTree(e,p))}}return{changes:t,scopes:i?[i]:void 0,timestamp:Date.now()}}getScopeSubTree(o,e){let t=o.get(e);return U(t)&&u(t.isLoaded(),"Scope must be loaded"),pe(t)}getAffectedScopeIDsAfterCrossScopeMove(o,e){let t=new Set;for(let n of e){if(!n.previousScope||!n.to.parentid)continue;let a=o.get(n.id),i=o.getScopeNodeFor(a);i&&t.add(i.id)}return t}};function Z(r,o){o.push({id:r,removed:"CanvasNode",to:{}})}function pe(r){if(r)return M.valueFromNode(r)}function ee(r,o){let e=new Set([j,_,H,V,N]);L.isOn("cmsQueryFromTree")&&(e.add(w),e.add(N)),o&&e.add(o);let t=r.getNodes(e).map(i=>M.valueFromNode(i)),n=r.root,a={};for(let i in n)F[i]||(a[i]=n[i]);return{version:E,root:{...a,__class:"RootNode",id:r.root.id,children:t}}}export{ye as a,G as b,Q as c,Y as d,Ke as e,X as f,Oe as g,ke as h,$ as i,ie as j,ae as k,we as l};
//# sourceMappingURL=https://app.framerstatic.com/chunk-CLVPFFWG.mjs.map
