import{a as d}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{j as l}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var f=',"children":[';function u(n,t,e){return n.slice(t,e+f.length)+"]}"}function P(n,t){let e=`"id":"${t}"`;return n.indexOf(e)>=0}function S(n,t=1){return n.startsWith(`{"v":${t},`)&&n.indexOf(f)>=0&&n.endsWith("]}}")}function D(n,t){if(n!=="children")return t}function y(n,t){let e=JSON.stringify(n,D),r=`${f}${t.join(",")}]`;return`${e.slice(0,-1)}${r}}`}function m(n){if(!n.children)return JSON.stringify(n);let t=n.children.map(e=>JSON.stringify(e));return y(n,t)}function h(n,t){return n==null||typeof n!="object"?!1:Object.hasOwnProperty.call(n,t)}var g=',"children":[',T=1,w=["contentManagement","externalModules","localModules","presets","colorStyles","routeSegmentRoot","entityRoot"],N=class{constructor(t,{dependencies:e,mustBeVersion:r}={}){l(this,"shallowPageToChildrenStrings",new Map);l(this,"idToShallowPage",new Map);l(this,"dependencies");l(this,"idToParsedPage",new Map);l(this,"root");l(this,"version");d(S(t,T),"The passed document string is not parsable");let o=t.indexOf(g),s=u(t,0,o),i=JSON.parse(s+"}"),a=i.header;this.root=i.root,this.version=i.version??0,this.dependencies=e??[],r&&d(this.version===r,"The passed document has an invalid version"),d(a&&Array.isArray(a),"The header from the Byte Addressable document is missing"),d(this.root.__class,"The document is missing a shallow root and a __class property"),this.populateShallowPagesData(t,a,o+g.length)}getPagesToLoad(){let t=new Set;for(let e of this.idToShallowPage.keys())this.idToParsedPage.has(e)||t.add(e);return t}analyzePage(t,e,r,o,s=new Set){s.add(e.id),r.delete(e.id);let i=h(e,"replicaInfo")&&typeof e.replicaInfo=="object"&&e.replicaInfo;if(i&&h(i,"master")&&typeof i.master=="string"&&(s.has(i.master)||r.add(i.master)),o&&e.codeComponentIdentifier==="framer/Prototype"){let a=h(e,"$control__children")&&typeof e.$control__children=="object"&&e.$control__children;if(a&&(h(a,"type")&&a.type)==="componentinstance"){let c=h(a,"value")&&a.value;if(typeof c=="string"&&!s.has(c))r.add(c);else if(Array.isArray(c)){let p=c[0];(h(p,"type")&&p.type)==="componentinstance"&&typeof p.value=="string"&&(s.has(p.value)||r.add(p.value))}}}if(e.children)for(let a of e.children)this.analyzePage(t,a,r,o,s)}parsePage(t){if(this.idToParsedPage.has(t))return;let e=this.idToShallowPage.get(t);e&&this.parseShallowPage(e)}parseAndAnalyzePage(t,e,r,o){if(this.idToParsedPage.has(t))return;let s=this.idToShallowPage.get(t);if(!s){if(o)return;d(s,"page id does not match tracked shallow pages")}let i=this.parseShallowPage(s);this.analyzePage(i,i,e,r)}deconstructPageAndChildren(t,e,r){let o=t.indexOf(g,e);if(o<0||o>e+r)return[JSON.parse(t.slice(e,e+r)),""];let s=JSON.parse(u(t,e,o)),i=t.slice(o+g.length-1,e+r-1);return[s,i]}populateShallowPagesData(t,e,r){let o=r;for(let s of e){let[i,a]=this.deconstructPageAndChildren(t,o,s);this.root.children.push(i),this.idToShallowPage.set(i.id,i),this.shallowPageToChildrenStrings.set(i,a),o+=s+1}}parsePageWithChildren(t,e){return e.length>0&&(t.children=JSON.parse(e)),this.idToParsedPage.set(t.id,t),t}parseShallowPage(t){let e=this.idToParsedPage.get(t.id);if(e)return e;let r=this.shallowPageToChildrenStrings.get(t);if(r===void 0)throw Error("Shallow page is not available in the map");return this.parsePageWithChildren(t,r)}parseDependentPages(t){let e=new Set;for(let r of t){if(this.idToParsedPage.has(r))continue;let o=this.idToShallowPage.get(r);if(o){let s=this.parseShallowPage(o);this.analyzePage(s,s,e,!1);continue}for(let s of this.parsePagesContainingId(r))this.analyzePage(s,s,e,!1)}e.size>0&&this.parseDependentPages(e)}getHomePageNodeID(){if(h(this.root,"homePageNodeId")&&typeof this.root.homePageNodeId=="string")return this.root.homePageNodeId}getShallowPages(){return[...this.shallowPageToChildrenStrings.keys()]}getShallowPage(t){return this.idToShallowPage.get(t)}getPartialDocumentForPageIds(t){for(let r of w)this.parsePage(r);let e=new Set;for(let r of this.dependencies)this.parseAndAnalyzePage(r,e,!0,!0);for(let r of t)this.parseAndAnalyzePage(r,e,!0,!1);return this.parseDependentPages(e),this.root}getParsedPageById(t){let e=this.idToParsedPage.get(t);return e||this.parsePageWithId(t)}parsePageWithId(t){if(this.idToParsedPage.has(t))return null;let e=this.idToShallowPage.get(t);if(!e)return null;let r=this.shallowPageToChildrenStrings.get(e);return typeof r!="string"?null:this.parsePageWithChildren(e,r)}parseNextPage(){for(let[t,e]of this.shallowPageToChildrenStrings)if(!this.idToParsedPage.has(t.id))return this.parsePageWithChildren(t,e)}parsePagesContainingId(t){let e=[];for(let[r,o]of this.shallowPageToChildrenStrings)this.idToParsedPage.has(r.id)||P(o,t)&&e.push(this.parsePageWithChildren(r,o));return e}getPagesContainingId(t){if(this.idToShallowPage.has(t))return[t];let e=[];for(let[r,o]of this.shallowPageToChildrenStrings)P(o,t)&&e.push(r.id);return e}};function I(n){let t=n.root,e=n.version,r=n.hash??0,o=t?.children;if(!o)return JSON.stringify(n);let{children:s,header:i}=v(o),a=y(t,s);return`{"v":${1},"header":${i},"version":${e},"hash":${r},"root":${a}}`}function v(n){let t=[],e=[];return n.forEach(r=>{let o=m(r);t.push(o),e.push(o.length)}),{children:t,header:JSON.stringify(e)}}export{S as a,N as b,I as c};
//# sourceMappingURL=https://app.framerstatic.com/chunk-B2X7EA3W.mjs.map
