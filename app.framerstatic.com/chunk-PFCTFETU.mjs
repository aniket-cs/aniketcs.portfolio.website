import{d as f}from"https://app.framerstatic.com/chunk-WKXRVQLW.mjs";import{f as X}from"https://app.framerstatic.com/chunk-ELABTCIQ.mjs";import{a as J}from"https://app.framerstatic.com/chunk-YE25YANI.mjs";import{r as q}from"https://app.framerstatic.com/chunk-AQDW5URV.mjs";import{Vc as $,_ as A,_a as Y,j as H,jb as D,re as Q}from"https://app.framerstatic.com/chunk-V5GH6H6A.mjs";import{e as _,i as j}from"https://app.framerstatic.com/chunk-RI5Y466T.mjs";import{f as G}from"https://app.framerstatic.com/chunk-DI2RBLGE.mjs";import{kd as z,nd as L,qc as K}from"https://app.framerstatic.com/chunk-OYNW3465.mjs";import{Ad as w,Dd as N,Ed as I,Mh as V,Op as W,Vd as B,Wd as E,sd as O}from"https://app.framerstatic.com/chunk-6EMDOY3A.mjs";import{c as R,d as F}from"https://app.framerstatic.com/chunk-L37WBKQV.mjs";import{o as P}from"https://app.framerstatic.com/chunk-NSAK4CRU.mjs";import{i as x,p as U}from"https://app.framerstatic.com/chunk-FKVUZ4GS.mjs";import{g as d}from"https://app.framerstatic.com/chunk-N5OTLEHJ.mjs";import{Y as T,k as C,q as k,t as h}from"https://app.framerstatic.com/chunk-IFLV2SXW.mjs";import{a as c}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{a as M}from"https://app.framerstatic.com/chunk-DFNFZLDR.mjs";import{j as s,k as g,l as S,o as b}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";function Ne(r,t){if(!r||r.changes.length===0)return!1;for(let e of r.changes){let o=t.get(e.id);if(!E(o)&&!B(o)&&!(!o&&e.added==="RedirectRouteNode"))return!1}return!0}function Z(r,t){if(!r||r.changes.length===0)return!1;for(let e of r.changes){let o=t.get(e.id);return!o||!W(o)?!1:"variables"in e.from}return!0}function ee(r,t){if(!r||r.changes.length===0)return!1;for(let e of r.changes){let o=t.get(e.id);if(!O(o))return!1;let n="locales";return!!(n in e.from||e.from._deleted?.includes(n))}return!0}var ce={type:"None",source:"undefined"},te=class extends z{constructor(){super(...arguments);s(this,"stack",[]);s(this,"dismiss",()=>{this.stack=T.pop(this.stack)});s(this,"isVisible",()=>this.active.type!=="None");s(this,"shouldShowConfirmationModal",e=>localStorage.getItem(me(e))!=="true");s(this,"shouldBlockUndoRedo",(e,o)=>{switch(this.active.type){case"None":return!1;case"Variables":return!Z(e,o);case"LocaleSettings":return!ee(e,o);default:return!0}})}get active(){return this.stack[this.stack.length-1]??ce}trackModalOpen({type:e,source:o}){G("modal_open",{modalType:e,source:o})}push(e){this.stack=T.push(this.stack,e),this.trackModalOpen(e)}set(e){this.stack=[e],this.trackModalOpen(e)}dismissModal(e){this.stack=T.filter(this.stack,o=>o.type!==e)}displayComponentIsolationModal({source:e}){let o="componentIsolationModal",n="1";d.isAutomation||d.isE2E||d.isTest||localStorage.getItem(o)!==n&&(localStorage.setItem(o,n),setTimeout(()=>{this.processWhenReady(()=>{this.set({type:"ComponentIsolationModal",source:e})})},0))}};function me(r){return`confirmation-modal-do-not-show-again-${r}`}var ue=h("EngineChanges");var oe=class{constructor(){s(this,"changes",new Set);s(this,"addChanges",(...t)=>{for(let e of t)this.changes.add(e)});s(this,"changeObserverFlags",[]);s(this,"changeObservers",[]);s(this,"inSignalAllObservers",!1);s(this,"observersToRemove",[])}get flags(){return this.changes}has(...t){for(let e of t)if(this.changes.has(e))return!0;return!1}observe(...t){let e=t.pop(),o=t;return d.isDebugBuild&&o.some(n=>n===void 0)&&ue.warn("changes.observe was called with undefined as one of the flags. It might be caused by observing a store that hasn't been instantiated yet."),this.changeObserverFlags.push(o),this.changeObservers.push(e),e}observeWithComponent(t,e,o){this.changeObserverFlags.push(t);let n=()=>{d.benchmarkSkipRendering||e.setState(o())};return this.changeObservers.push(n),n}removeObserver(t){if(this.inSignalAllObservers){this.observersToRemove.push(t);return}let e=this.changeObservers.indexOf(t);e!==-1&&(this.changeObserverFlags.splice(e,1),this.changeObservers.splice(e,1))}signalAllObservers(){if(!this.changes)return;let t=this.changes,e=this.changeObserverFlags,o=this.changeObservers;this.inSignalAllObservers=!0;for(let n=0;n<e.length;n++){let i=e[n];for(let a of i)if(t.has(a)){o[n]();break}}if(this.inSignalAllObservers=!1,this.observersToRemove.length>0){for(let n of this.observersToRemove)this.removeObserver(n);this.observersToRemove.length=0}this.changes.clear()}signalObserversFor(...t){let e=new Set(t),o=this.changeObserverFlags,n=this.changeObservers;for(let i=0;i<o.length;i++){let a=o[i];for(let l of a)if(e.has(l)){n[i]();break}}e.forEach(i=>this.changes.delete(i))}};function re(r,t){if(r.projectStore.projectLicenseType===q())return r.modalStore.set({type:"Upsell",source:"upsell",title:"Upgrade to Enterprise",description:"Sign up for an Enterprise plan to increase your file upload limit to 150MB and unlock other powerful features that help scale your site.",upsell:"file-limit-upsell",confirmLabel:"Contact us",cancelLabel:"Maybe Later",upsellSitePlan:"enterpriseSite",upsellFeatures:["Advanced Permissions","Custom Limits","Custom Hosting","Custom Proxy Support","Enterprise Security","Dedicated Support"]});let e=r.projectStore.resourceLimits?.fileUploadLimitInMB;c(typeof e=="number","fileUploadLimitInMB is not a number");let o=e.toLocaleString()+"MB",n=(t/X).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:1})+"MB";return r.modalStore.set({source:"upsell",type:"UpsellFeature",upsellFeature:"fileUploadLimitInMB",description:`Your current plan limits file uploads to ${o}, and you\u2019re trying to upload a file that\u2019s ${n}. Upgrade your site to increase the limit and upload your file.`})}var m,y,v=class{constructor(t){this.limit=t;S(this,m,0);S(this,y,[])}async run(t,e){if(g(this,m)===this.limit){let o=new Promise(n=>{g(this,y).push(n)});e&&(o=Promise.race([o,fe(e)])),await o}ie(e),b(this,m)._++;try{return await t()}finally{b(this,m)._--,g(this,y).shift()?.()}}};m=new WeakMap,y=new WeakMap;var ne=new WeakMap;function fe(r){let t=ne.get(r);return t||(ie(r),t=new Promise((e,o)=>{r.addEventListener("abort",()=>{o(r.reason)},{once:!0})}),ne.set(r,t)),t}function ie(r){if(r?.aborted)throw r.reason}var ae=class{constructor(t,{concurrency:e=5,silent:o=!1}={}){this.engine=t;s(this,"uploads",new Map);s(this,"completed",0);s(this,"failed",0);s(this,"generating",!1);s(this,"resolveStatusUpdate");s(this,"limiter");s(this,"silent");this.limiter=new v(e),this.silent=o}add(t){return this.createTask(t,e=>e)()}createTask(t,e){let o=this.uploads.get(t);o||(o={task:async()=>{try{return typeof t=="string"?t.startsWith("data:")?await this.uploadFile(await J(t,"imported")):await f.uploadAssetByURL(t,{silent:this.silent,refreshAssetService:!1}):await this.uploadFile(t)}catch(a){throw this.failed++,a}finally{this.completed++,this.resolveStatusUpdate?.()}}},this.uploads.set(t,o));let n=o;return async()=>(n.resultPromise||(n.resultPromise=this.limiter.run(n.task),this.resolveStatusUpdate?.()),e(await n.resultPromise))}async uploadFile(t){let e=this.engine.projectStore.resourceLimits?.fileUploadLimitInMB??void 0,o={silent:this.silent,maxFileSize:e,onExceedsCustomMaxSize:i=>re(this.engine,i),refreshAssetService:!1},n;if(t.type.startsWith("image/")?n=await f.uploadImage(t,o):t.type.startsWith("video/")?n=await f.uploadVideo(t,o):n=await f.uploadFile(t,o),!n)throw Error("Failed to upload file");return n}get active(){return[...this.uploads.values()].map(({resultPromise:t})=>t).filter(x)}get status(){let{active:t,completed:e,failed:o}=this;return{started:t.length,completed:e,failed:o}}async*statusUpdates(){if(this.generating)throw Error("`statusUpdates` is in use by another call");for(this.generating=!0,yield this.status;this.completed<this.active.length;)await new Promise(t=>{this.resolveStatusUpdate=()=>{t(),this.resolveStatusUpdate=void 0}}),yield this.status;await this.engine.webAssetsService?.refresh().catch(C),this.generating=!1}async results(){let t=await Promise.allSettled(this.active).then(e=>e.filter(U).map(o=>o.value));return await this.engine.webAssetsService?.refresh().catch(C),t}};function st(r,t){let e,o,n,i;for(let l of r)N(l,!0)?(t===l.id&&(e=e??l),l.dataIdentifier?n=n??l:o=o??l):I(l,!0)&&(i=i??l);let a=e??o??n??i;return c(a,"getFirstCanvasPageOrWebPageNode: Tree must contain at least one Canvas Page or Web Page"),a}function lt(r){return r?N(r,!0)||I(r,!0)||w(r,!0):!1}function ye(r){return r!==void 0?{ok:!0,value:r}:{ok:!0}}function ge(r){return{ok:!1,error:r}}function pt(r){return r.then(t=>ye(t),t=>ge(t))}var gt=k({canvas:()=>{let r=he();return F(r),R(r)},onPageCanvas:()=>{let r=Te();return F(r),R(r)}});function he(){let r=d.isDebugBuild?"canvas-sandbox.debug.html":"canvas-sandbox.html",t=L(`./${r}`),e=JSON.stringify(M());return t+`#services=${encodeURIComponent(e)}`}function Te(){let r=d.isDebugBuild?"canvas-sandbox-on-page.debug.html":"canvas-sandbox-on-page.html",t=L(`./${r}`),e=JSON.stringify(M());return t+`#services=${encodeURIComponent(e)}`}var ve=3,u=h("PartialTreeSender");var se=class{constructor(t,e){this.timeline=t;s(this,"name");s(this,"currentScopeId","");s(this,"timelineCursor");s(this,"scopeBufferMap",new Map);this.name=e+"-"+String(Math.round(Math.random()*1e3))}resetScopeBuffer(t){this.scopeBufferMap.clear(),this.currentScopeId=t??"",t&&(this.timelineCursor=void 0,this.scopeBufferMap.set(t,performance.now()))}updateScopeBuffer(t){if(this.currentScopeId===t)return[void 0,void 0];if(this.currentScopeId=t,this.scopeBufferMap.has(this.currentScopeId))return this.scopeBufferMap.set(this.currentScopeId,performance.now()),[void 0,void 0];let e;if(this.scopeBufferMap.size>=ve){let o=1/0,n="";for(let[i,a]of this.scopeBufferMap)o>a&&(o=a,n=i);c(n.length>0,"must have removed a scope from the buffer"),this.scopeBufferMap.delete(n),e=n}return this.scopeBufferMap.set(this.currentScopeId,performance.now()),[e,t]}reset(t){let e=this.timeline.tree;return this.resetScopeBuffer(t),de(e,t)}update(t){if(!t)return{};let e=this.timeline.tree,o=this.timeline.fetchForwardChanges(this.timelineCursor);if(!o)return this.timeline.invalidatedByLoadCompletedDocument(this.timelineCursor)?(u.debug(this.name,"cursor invalidated, sending empty update for load completed document"),this.timelineCursor=this.timeline.getChangeTrackingCursor(),{}):(u.debug(this.name,"cursor invalidated, sending tree with scope:",t),this.resetScopeBuffer(t),this.timelineCursor=this.timeline.getChangeTrackingCursor(),{name:this.name,tree:de(e,t),timestamp:Date.now()});let[n,i]=this.updateScopeBuffer(t);n&&(u.debug(this.name,"deleting scope by diff:",n),le(n,o)),o.length===0&&(o=void 0);let a;if(i&&(u.debug(this.name,"adding scope by subtree:",i),a=this.getScopeSubTree(e,i)),o){let l=this.getAffectedScopeIDsAfterCrossScopeMove(e,o);for(let p of l){if(p!==this.currentScopeId){this.scopeBufferMap.has(p)&&(u.debug(this.name,"deleting scope due to cross-scope move:",p),le(p,o),this.scopeBufferMap.delete(p));continue}a||(u.debug(this.name,"resending tree with scope due to cross-scope move:",p),a=this.getScopeSubTree(e,p))}}return{changes:o,scopes:a?[a]:void 0,timestamp:Date.now()}}getScopeSubTree(t,e){let o=t.get(e);return _(o)&&c(o.isLoaded(),"Scope must be loaded"),Se(o)}getAffectedScopeIDsAfterCrossScopeMove(t,e){let o=new Set;for(let n of e){if(!n.previousScope||!n.to.parentid)continue;let i=t.get(n.id),a=t.getScopeNodeFor(i);a&&o.add(a.id)}return o}};function le(r,t){t.push({id:r,removed:"CanvasNode",to:{}})}function Se(r){if(r)return A.valueFromNode(r)}function de(r,t){let e=new Set([$,Y,Q]);P.isOn("vectorSets")&&(e.add(K),e.add(D)),P.isOn("cmsQueryFromTree")&&(e.add(j),e.add(D)),t&&e.add(t);let o=r.getNodes(e).map(a=>A.valueFromNode(a)),n=r.root,i={};for(let a in n)V[a]||(i[a]=n[a]);return{version:H,root:{...i,__class:"RootNode",id:r.root.id,children:o}}}export{Ne as a,ee as b,te as c,oe as d,gt as e,se as f,st as g,lt as h,v as i,ye as j,ge as k,pt as l,ae as m};
//# sourceMappingURL=https://app.framerstatic.com/chunk-PFCTFETU.mjs.map
