import{e as R}from"https://app.framerstatic.com/chunk-N7HPSFVJ.mjs";import{Pg as N,Ta as me,a as ae,b as le,c as ce,eg as S,j as L}from"https://app.framerstatic.com/chunk-V5GH6H6A.mjs";import{e as se}from"https://app.framerstatic.com/chunk-RI5Y466T.mjs";import{tc as de}from"https://app.framerstatic.com/chunk-OYNW3465.mjs";import{Ch as E,Dd as q,Ed as Q,Fb as H,Gb as x,Gh as ne,Hb as J,Id as A,Kb as w,Mb as $,Vd as X,Zd as Y,_d as Z,bm as re,ee as j,l as B,ph as oe,qe as _,rh as ie,te as ee,we as te}from"https://app.framerstatic.com/chunk-6EMDOY3A.mjs";import{b as g,c as G,d as T,e as y}from"https://app.framerstatic.com/chunk-FKVUZ4GS.mjs";import{o as W,t as z}from"https://app.framerstatic.com/chunk-IFLV2SXW.mjs";import{a as v}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{j as C}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var F=class extends Error{constructor(e,i){super(`Document version is too low. Expected ${i}, got ${e}.`)}},M=class extends Error{constructor(e,i){super(`Document version is too high. Expected ${i}, got ${e}.`)}};function fe(t){if(!le(t)||t===null)throw Error("Invalid document.");if(!G(t.version))throw Error("Unable to read document.version");if(!t.root)throw Error("Unable to read document.root");if(t.version<N.minimumLegacySerializationVersion)throw new F(t.version,N.minimumLegacySerializationVersion);if(t.version>L)throw new M(t.version,L)}function D(t,e){let i=!1;function o(d,s,l){if(!d)return;let a=d.id;if(l.has(a)){i=!0,e&&e.push({id:a,stack:s.slice()});return}if(l.add(a),s.push(a),A(d)){let c=d.getRawControlProps(),f=Object.keys(c);for(let u of f){let p=c[u];if(p){if(p.type==="slot"&&y(p.value))for(let h of p.value){if(!T(h))continue;let k=h["reference"];if(!g(k))continue;let Te=t.get(k);o(Te,s,l)}else if(p.type==="componentinstance"&&g(p.value)){let h=t.get(p.value);o(h,s,l)}else if(y(p.value))for(let h of p.value){if(!T(h)||h.type!=="componentinstance")continue;let b=h.value;if(!g(b))continue;let k=t.get(b);o(k,s,l)}}}}let m=d.children;if(m)for(let c=0,f=m.length;c<f;c++)o(m[c],s,l);l.delete(a),s.pop()}let n=new Set,r=[];return o(t.root,r,n),i}function je(t,e){fe(t);let i=ce(t),o=S(i.root,null,{extraChecksAndFixes:!0,errors:e,warnings:e});if(!o)throw Error("Unable to create load document");be(o,e);let n=new Map;K(n,e,o,oe),Ae(n,o,e);let r=N.createByAdoptingRoot(o);r.verify(),r=re.treeDidLoad(r,e).didNonLinearMove(B);let d=[];return D(r,d)&&(d.forEach(s=>{e.push(`${s.id}: code component links itself via ${s.stack}`),U(r,s.id,s.stack)}),r=r.commit()),r}function V(t,e){let i=new Map;K(i,e,t,t.parentid),we(i,t,e)}function Ne(t){return Q(t)||q(t)}function be(t,e=[]){let i=t.children,o=i.find(Ne);o===void 0&&(e.push(`${t.id}: Root does not contain a page`),o=new me({id:ae(t)}),i.push(o));for(let n=0;n<i.length;n++){let r=i[n];r&&(se(r)||J(r)||te(r)||de(r)||j(r)||X(r)||Y(r)||_(r)||ee(r)||Z(r)||(e.push(`${r.id}: Ground node is not on a page`),i.splice(n--,1),o.children.push(r),r.parentid=o.id))}}function U(t,e,i){let o=t.get(i[i.length-1]);if(!A(o))return;let n=o.getRawControlProps(),r={};for(let s in n){let l=n[s];if(!l)continue;let{type:a,value:m}=l;if(a==="slot"&&y(m)){let c=m.filter(f=>T(f)?f["reference"]!==e:!0);c.length!==m.length&&(r[s]={type:"slot",value:c})}else if(a==="componentinstance"&&m===e)r[s]={type:"slot",value:[]};else if(y(m)){let c=m.filter(f=>!T(f)||f.type!=="componentinstance"?!0:f.value!==e);c.length!==m.length&&(r[s]={type:"array",value:c})}}if(W(r))return;let d=ne(r);o.set(d)}function K(t,e,i,o){for(i.parentid=o;t.has(i.id);)e.push(`${i.id}: duplicate id in document`),i.id=ie();t.set(i.id,i);let n=i.children;if(n)for(let r=0,d=n.length;r<d;r++)K(t,e,n[r],i.id)}function Ae(t,e,i){for(let o of e.walk())v(o.isMutable()),A(o)&&pe(t,o.id,new Set([o.id]),o,i),x(o)&&ue(t,o,o,i),w(o)&&(he(t,o,i),ge(t,o,i)),$(o)&&Ce(o,i)}function we(t,e,i){for(let o of e.walk())v(o.isMutable()),w(o)?ge(t,o,i):$(o)&&Ce(o,i)}function pe(t,e,i,o,n){function r(l){if(!g(l))return!1;if(i.has(l))return n.push(`${e}: code component links itself via ${o.id}`),!0;let a=t.get(l);if(!a)return n.push(`${o.id}: code component has bad link at ${l}`),!0;let m=!1;for(let c of a.walk())i.has(c.id)?(n.push(`${e}: code component links itself via ${o.id} via ${l}`),m=!0):A(c)&&pe(t,e,new Set([...i,c.id]),c,n);return m}let d=o.getRawControlProps(),s=Object.keys(d);for(let l of s){let a=d[l];if(!E(a))continue;if(a.type==="slot"&&y(a.value)){let f=[];for(let u=0;u<a.value.length;u++){let p=a.value[u];if(!T(p))continue;let b=p["reference"];g(b)&&r(b)&&f.push(u)}for(;f.length>0;)a.value.splice(f.pop(),1);continue}if(a.type==="componentinstance"&&g(a.value)){if(!r(a.value))continue;a.value=void 0;continue}let m=a.value;if(!Array.isArray(m))continue;let c=[];for(let f=0,u=m.length;f<u;f++){let p=m[f];E(p)&&p.type==="componentinstance"&&g(p.value)&&r(p.value)&&c.push(f)}for(;c.length>0;)m.splice(c.pop(),1)}}function O(t){t.originalid=null,t.replicaInfo=null}function ue(t,e,i,o){for(let n of i.walk())if(n!==i&&H(n)&&w(n)){let r=he(t,n,o);if(!r)continue;if(e===r){o.push(`${e.id}: template component links itself via ${i.id}`),O(n);continue}ue(t,e,r,o)}}function he(t,e,i){let o=e.replicaInfo.master,n=t.get(o);return n?x(n)?(e.originalid!==o&&(i.push(`${e.id}: template originalid doesn't point to master id: ${e.originalid}`),e.originalid=o),n):(i.push(`${e.id}: template references a node that is not a master: ${o}`),O(e),null):(i.push(`${e.id}: template references a master that doesn't exist: ${o}`),O(e),null)}function ge(t,e,i){if(!e.replicaInfo)return;let o=e.replicaInfo.inheritsFrom;if(!o)return;let n=t.get(o);n?!x(n)&&!w(n)&&(i.push(`${e.id}: template references an inherit that isn't a master or a replica: ${o}`),e.replicaInfo.inheritsFrom=void 0):(i.push(`${e.id}: template references an inherit that doesn't exist: ${o}`),e.replicaInfo.inheritsFrom=void 0)}function Ce(t,e){t.originalid&&(t.originalid=null,e.push(`${t.id}: removing original id from orphan replica child`))}var I=z("remote:verify");function st(t,e,i){let o=t.getPartialDocumentForPageIds(e),n=[],r=I.isLoggingTraceMessages()?[]:void 0,d=S(o,null,{extraChecksAndFixes:!0,errors:n,warnings:r});R("parsingRootNode"),v(d,"error loading root node:",o.id,n);for(let l of d.children??[])l.children&&l.children.length>0&&V(l,n);n.length>0&&I.warn("errors loading server tree: "+n.join(`
`)),r&&r.length>0&&I.trace("warnings loading server tree: "+r.join(`
`));let s=N.createByAdoptingRoot(d,i);return s.loadReplicasAndCodeComponents(s.root),R("parsingReplicasExpansion"),s.hasUncommittedChanges()&&(s=s.commit()),s}function at(t,e){let i=t.parseNextPage();if(!i)return!0;let o=[],n=S(i,t.root.id,{extraChecksAndFixes:!0,errors:o});return v(n,"error loading page node:",i.id,o),V(n,o),o.length>0&&I.warn("warnings loading server tree: "+o.join(`
`)),e.set(n.id,n),!1}function lt(t,e){t.makeLatest(),t.editClosed=!1,t.isViewOnly=!1;for(let[i,o]of t.root.children.entries()){let n=e.get(o.id);n&&(t.remove(n.id),t.insertNode(n,t.root.id,i))}return t.inEditor=!1,t.loadReplicasAndCodeComponents(t.root),t.hasUncommittedChanges()&&(t=t.commit()),t.inEditor=!0,t}var P=class t{constructor(){C(this,"editClosed",!1);C(this,"isViewOnly",!1);C(this,"inEditor",!1);C(this,"processingLocalUserEdits",!1)}static from(e){let i=new t;return i.editClosed=e.editClosed,i.isViewOnly=e.isViewOnly,i.inEditor=e.inEditor,i.processingLocalUserEdits=e.processingLocalUserEdits,i}restore(e){e.editClosed=this.editClosed,e.isViewOnly=this.isViewOnly,e.inEditor=this.inEditor,e.processingLocalUserEdits=this.processingLocalUserEdits}static setForAssembly(e){e.editClosed=!1,e.isViewOnly=!1,e.inEditor=!1,e.processingLocalUserEdits=!1}},ve=class{constructor(e,i,o){this.engine=e;this.treeToAssemble=i;C(this,"pagesToAssemble");C(this,"isSetupNeeded",!0);C(this,"engineTreeFlags",new P);this.pagesToAssemble=Array.from(o.values())}setupAssemblerTreeStateIfNeeded(){this.isSetupNeeded&&(this.isSetupNeeded=!1,this.engineTreeFlags=P.from(this.engine.tree),this.treeToAssemble.isLatest()||this.treeToAssemble.makeLatest(),P.setForAssembly(this.treeToAssemble))}restoreEngineTreeState(){this.isSetupNeeded||(this.isSetupNeeded=!0,this.treeToAssemble.hasUncommittedChanges()&&(this.treeToAssemble=this.treeToAssemble.commit()),this.engine.tree.isLatest()||this.engine.tree.makeLatest(),this.engineTreeFlags.restore(this.engine.tree))}assembleOnePage(){if(this.pagesToAssemble.length===0)return!0;this.setupAssemblerTreeStateIfNeeded();let e=this.pagesToAssemble.pop();v(e);let i=this.treeToAssemble.root.children.findIndex(o=>o.id===e.id);return i<0?!1:(this.treeToAssemble.remove(e.id),this.treeToAssemble.insertNode(e,this.treeToAssemble.root.id,i),this.treeToAssemble.loadReplicasAndCodeComponents(e),this.treeToAssemble=this.treeToAssemble.commit(),this.pagesToAssemble.length===0)}buildCompleteTree(){v(this.pagesToAssemble.length===0,"must be done with assembleOnePage"),this.setupAssemblerTreeStateIfNeeded(),this.treeToAssemble.loadReplicasAndCodeComponents(this.treeToAssemble.root),this.treeToAssemble.hasUncommittedChanges()&&(this.treeToAssemble=this.treeToAssemble.commit()),this.treeToAssemble.verify();let e=[],i=[];return D(this.treeToAssemble,i)&&(i.forEach(o=>{e.push(`${o.id}: code component links itself via ${o.stack}`),U(this.treeToAssemble,o.id,o.stack)}),this.treeToAssemble=this.treeToAssemble.commit()),e.length>0&&I.warn("warnings loading server tree: "+e.join(`
`)),this.engineTreeFlags.restore(this.treeToAssemble),this.treeToAssemble}};export{je as a,V as b,st as c,at as d,lt as e,P as f,ve as g};
//# sourceMappingURL=https://app.framerstatic.com/chunk-3F65KONI.mjs.map
